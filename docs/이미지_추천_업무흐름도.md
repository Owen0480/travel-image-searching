# ì´ë¯¸ì§€ ì¶”ì²œ ë¡œì§ - ì—…ë¬´ íë¦„ë„ (Mermaid)

ì—…ë¬´ íë¦„ë„ ìŠ¤íƒ€ì¼: **ë¹¨ê°„ ì› = ì‹œì‘/ì¢…ë£Œ**, **íŒŒë€ ì‚¬ê°í˜• = í”„ë¡œì„¸ìŠ¤**, **ë§ˆë¦„ëª¨ = íŒë‹¨**.

---

## Mermaid Flowchart ì½”ë“œ

```mermaid
flowchart TB
    subgraph Frontend["ğŸ–¥ï¸ travel-frontend (React)"]
        A((ì‹œì‘))
        A --> B[ì‚¬ì§„ + ì·¨í–¥ ì…ë ¥]
        B --> C[FormData: file, preference]
        C --> D[POST /api/v1/recommend/analyze<br/>Spring Boot 8081]
        D --> E[ë¡œë”© í‘œì‹œ]
        E --> F[ì‘ë‹µ ìˆ˜ì‹ ]
        F --> G[ê²°ê³¼ ì¹´ë“œ 3ê°œ í‘œì‹œ<br/>ì´ë¯¸ì§€: FastAPI /images]
        G --> H((ë))
    end

    subgraph SpringBoot["â˜• travel-springboot"]
        D -.-> I[RecommendController<br/>file, preference ìˆ˜ì‹ ]
        I --> J[RecommendService.analyzeImage]
        J --> K[POST FastAPI 8000<br/>/api/v1/recommend/analyze<br/>Multipart: file, preference]
        K -.-> L[FastAPI ì‘ë‹µ ê·¸ëŒ€ë¡œ ë°˜í™˜]
        L -.-> F
    end

    subgraph FastAPI["ğŸ backend-fastapi"]
        K -.-> M[recommend ì—”ë“œí¬ì¸íŠ¸<br/>file, preference ìˆ˜ì‹ ]
        M --> N[analyze_image í˜¸ì¶œ]
        N --> O[CLIP: ì‚¬ìš©ì ì´ë¯¸ì§€ ì„ë² ë”©<br/>model.encode â†’ user_img_emb]
        O --> P[ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚°<br/>user_img_emb vs db_features]
        P --> Q{ìœ ì‚¬ë„ > 0.6<br/>ì¥ì†Œ ìˆìŒ?}
        Q -->|Yes| R[CSV: _get_place_info<br/>ì¥ì†Œëª…Â·ì£¼ì†ŒÂ·POI ì¡°íšŒ]
        R --> S[Top3 ì •ë ¬]
        S --> T[ChromaDB: _retrieve_place_chunks<br/>preference + ì¥ì†Œëª… + POI ë¡œ ì¿¼ë¦¬<br/>visit_area_id í•„í„° â†’ ì²­í¬ 3ê°œ]
        T --> U[Gemini: _generate_travel_guide<br/>retrieved_chunks + preference â†’ Top1 ê°€ì´ë“œ]
        U --> V[Top2/3: _generate_short_guide<br/>CSV ê¸°ë°˜, Gemini ë¯¸ì‚¬ìš©]
        V --> W[results ë°˜í™˜]
        W -.-> L
        Q -->|No| X[Gemini: ì‚¬ì§„ í•œ ë¬¸ì¥ ì„¤ëª… ì‹œë„]
        X --> Y[ai_analysis ë°˜í™˜]
        Y -.-> L
    end

    subgraph Data["ğŸ“¦ ë°ì´í„°/ëª¨ë¸"]
        P --> DB[(db_features<br/>CLIP ì‚¬ì „ ê³„ì‚°)]
        T --> Chroma[(ChromaDB<br/>ì¥ì†Œ ë¬¸ì„œ ì²­í¬)]
        U --> Gemini[Gemini API]
    end

    %% ìŠ¤íƒ€ì¼: ë¹¨ê°„ ì›=ì‹œì‘/ë, íŒŒë€ ì‚¬ê°í˜•=í”„ë¡œì„¸ìŠ¤, ë§ˆë¦„ëª¨=íŒë‹¨
    classDef startEnd fill:#e74c3c,stroke:#c0392b,color:#fff
    classDef process fill:#3498db,stroke:#2980b9,color:#fff
    classDef decision fill:#f1c40f,stroke:#d4ac0d,color:#000
    classDef data fill:#9b59b6,stroke:#8e44ad,color:#fff

    class A,H startEnd
    class B,C,D,E,F,G,I,J,K,M,N,O,P,R,S,T,U,V,W,X,Y process
    class Q decision
    class DB,Chroma,Gemini data
```

---

## ê°„ë‹¨ ë²„ì „ (Spring Boot â†” FastAPI, CLIPÂ·ChromaDB ìœ„ì¹˜ë§Œ)

```mermaid
flowchart LR
    subgraph Client
        A((ì‹œì‘)) --> B[ì‚¬ì§„+ì·¨í–¥]
        B --> C[Spring 8081<br/>POST]
    end

    subgraph SpringBoot["Spring Boot"]
        C --> D[RecommendService<br/>file, preference]
        D --> E[FastAPI 8000<br/>POST]
    end

    subgraph FastAPI["FastAPI"]
        E --> F[CLIP: ì´ë¯¸ì§€ ì„ë² ë”©]
        F --> G[ìœ ì‚¬ë„: db_features]
        G --> H[Top3 + CSV ì¡°íšŒ]
        H --> I[ChromaDB: ì²­í¬ ê²€ìƒ‰]
        I --> J[Gemini: Top1 ê°€ì´ë“œ]
        J --> K[results ë°˜í™˜]
    end

    K --> D
    D --> L[Frontend ê²°ê³¼ í‘œì‹œ]
    L --> M((ë))

    style A fill:#e74c3c,color:#fff
    style M fill:#e74c3c,color:#fff
    style D fill:#3498db,color:#fff
    style F fill:#3498db,color:#fff
    style I fill:#9b59b6,color:#fff
    style J fill:#9b59b6,color:#fff
```

---

## ìš”ì†Œ ì„¤ëª…

| ìš”ì†Œ | ì˜ë¯¸ |
|------|------|
| **ë¹¨ê°„ ì›** | ì‹œì‘ / ì¢…ë£Œ |
| **íŒŒë€ ì‚¬ê°í˜•** | í”„ë¡œì„¸ìŠ¤ (ì²˜ë¦¬ ë‹¨ê³„) |
| **ë…¸ë€ ë§ˆë¦„ëª¨** | íŒë‹¨ (ìœ ì‚¬ ì¥ì†Œ ìˆìŒ?) |
| **ë³´ë¼ìƒ‰** | ë°ì´í„°/ì™¸ë¶€ (CLIP db_features, ChromaDB, Gemini) |
| **Spring Boot** | fileÂ·preference ìˆ˜ì‹  â†’ FastAPIë¡œ ê·¸ëŒ€ë¡œ ì „ë‹¬ â†’ ì‘ë‹µ ê·¸ëŒ€ë¡œ í”„ë¡ íŠ¸ë¡œ ì „ë‹¬ |
| **CLIP** | ì‚¬ìš©ì ì´ë¯¸ì§€ â†’ ë²¡í„°í™”, DB ì´ë¯¸ì§€ ë²¡í„°(db_features)ì™€ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ â†’ Top3 |
| **ChromaDB** | preference + ì¥ì†Œëª… + POIë¡œ ì¿¼ë¦¬ â†’ í•´ë‹¹ ì¥ì†Œ(visit_area_id) ì²­í¬ ê²€ìƒ‰ â†’ RAG ê·¼ê±° |
| **Gemini** | Chromaì—ì„œ ê°€ì ¸ì˜¨ ì²­í¬ + preferenceë¡œ Top1 ê°€ì´ë“œ ìƒì„± |

ìœ„ ì½”ë“œë¥¼ [Mermaid Live Editor](https://mermaid.live) ë˜ëŠ” VS Code Mermaid í™•ì¥ì—ì„œ ë Œë”ë§í•˜ë©´ ë©ë‹ˆë‹¤.
